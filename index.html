<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OSCloze · Chinese Cloze Practice</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app">
    <nav class="nav" aria-label="Main">
      <a href="#" class="nav-link active" data-view="play">Play</a>
      <a href="#" class="nav-link" data-view="sentences">Sentences</a>
      <a href="#" class="nav-link" data-view="settings">Settings</a>
    </nav>

    <div class="content">
      <section id="playView" class="view is-active" role="main" data-view="play">
        <header class="header header--play">
          <h1>OSCloze</h1>
          <div class="header-play-actions">
            <button type="button" id="playSettingsBtn" class="icon-btn" aria-label="Play settings" title="Settings">&#9881;</button>
          </div>
        </header>
        <div id="playContent" class="play-content play-content--config">
          <div id="playConfig" class="play-config">
            <h2 class="play-config-title">New session</h2>
            <div class="play-config-row">
              <label for="playCollection" class="play-config-label">Collection</label>
              <select id="playCollection" class="play-config-select" aria-label="Select collection"></select>
            </div>
            <div class="play-config-row">
              <label for="playCount" class="play-config-label">Number of sentences</label>
              <select id="playCount" class="play-config-select" aria-label="Number of sentences">
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="20">20</option>
              </select>
            </div>
            <button type="button" id="playStart" class="btn btn-primary">Start</button>
          </div>
          <div id="playGame" class="main">
            <p class="progress" id="progress"></p>
            <p class="sentence sentence-target" id="sentence"></p>
            <input
              type="text"
              id="answer"
              autocomplete="off"
              aria-label="Your answer"
              class="answer-input"
            />
            <p class="sentence sentence-native" id="sentenceNative"></p>
            <div id="answerRow" class="check-row">
              <button type="button" id="check" class="btn btn-primary">Check</button>
            </div>
            <div class="feedback" id="feedback" role="status" aria-live="polite" hidden></div>
            <div class="post-check-row" id="postCheckRow" hidden>
              <button type="button" id="next" class="btn btn-secondary">Next</button>
              <button type="button" id="viewExplanation" class="btn btn-ghost">View Explanation</button>
            </div>
            <div class="explanation" id="explanation" hidden></div>
          </div>
          <div id="playReview" class="review-panel">
            <h2 class="review-title">本课总结</h2>
            <ul class="review-list" id="reviewList"></ul>
            <button type="button" id="playAgain" class="btn btn-primary">Play again</button>
          </div>
        </div>
      </section>

      <section id="sentencesView" class="view" role="main" data-view="sentences">
        <header class="header">
          <h1>Sentences</h1>
          <p class="header-desc">View all sentences. Add or edit via the button below. Filter by collection.</p>
        </header>
        <div class="sentences-toolbar">
          <button type="button" id="openAddSentence" class="btn btn-primary">Add sentence</button>
          <button type="button" id="newCollectionBtn" class="btn btn-secondary">New collection</button>
        </div>
        <ul class="sentence-list" id="sentenceList" aria-label="All sentences"></ul>
      </section>

      <section id="settingsView" class="view" role="main" data-view="settings">
        <header class="header">
          <h1>Settings</h1>
        </header>
        <div class="settings-panel">
          <label class="toggle-switch settings-toggle" aria-label="Light mode">
            <input type="checkbox" id="lightMode" />
            <span class="toggle-slider"></span>
            <span class="toggle-text">Light mode</span>
          </label>
          
          <h2 class="settings-subtitle">Progress</h2>
          <p class="settings-desc">Reset all star progress for every sentence. This cannot be undone.</p>
          <button type="button" id="resetProgress" class="btn btn-secondary">Reset all progress</button>
          <p id="resetConfirm" class="settings-confirm" hidden>Progress has been reset.</p>
          
          <h2 class="settings-subtitle" style="margin-top: 1.5rem;">Backup & Restore</h2>
          <p class="settings-desc">Download your data (stars, custom sentences, edits, collections) as a backup file.</p>
          <button type="button" id="downloadSaveBtn" class="btn btn-primary">Download Save File</button>
          
          <p class="settings-desc" style="margin-top: 1rem;">Restore from a previously downloaded backup file. This will overwrite your current data.</p>
          <input type="file" id="uploadSaveFile" accept=".json" style="display: none;" />
          <button type="button" id="restoreSaveBtn" class="btn btn-secondary">Restore from File</button>
          <p id="restoreConfirm" class="settings-confirm" hidden></p>
        </div>
      </section>
    </div>
  </div>

  <div id="sentenceModal" class="modal-overlay" hidden aria-modal="true" role="dialog" aria-labelledby="sentenceFormTitle">
    <div class="modal">
      <div class="modal-header">
        <h2 class="form-panel-title" id="sentenceFormTitle">Add sentence</h2>
        <button type="button" class="modal-close" id="modalClose" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-row form-row--edit-only" id="formStarRow" hidden>
          <div class="form-star-display">
            <span class="form-label">Progress</span>
            <div class="form-star-line">
              <span id="formStarDisplay" class="form-star-value"></span>
              <button type="button" id="resetSingleStar" class="btn btn-secondary btn-sm">Reset</button>
            </div>
          </div>
        </div>
        <div class="form-row">
          <label for="formCollection" class="form-label">Collection</label>
          <select id="formCollection" class="form-input form-select" aria-label="Select collection"></select>
        </div>
        <div class="form-row">
          <label for="formSentence" class="form-label">Target language (sentence with blank)</label>
          <textarea id="formSentence" class="form-input form-textarea" placeholder="e.g. The capital of France is _____." rows="2"></textarea>
          <button type="button" id="insertBlank" class="btn btn-secondary btn-sm">Insert blank (_____)</button>
        </div>
        <div class="form-row">
          <label for="formNativeSentence" class="form-label">Native language (full sentence)</label>
          <input type="text" id="formNativeSentence" class="form-input" placeholder="e.g. The capital of France is Paris." />
        </div>
        <div class="form-row">
          <label for="formPinyin" class="form-label">Pinyin (optional)</label>
          <input type="text" id="formPinyin" class="form-input" placeholder="e.g. bā lí shì fà guó de shǒu dū." />
        </div>
        <div class="form-row">
          <label for="formNativeKeyword" class="form-label">Keyword in native sentence to highlight (optional)</label>
          <input type="text" id="formNativeKeyword" class="form-input" placeholder="e.g. Paris" />
        </div>
        <div class="form-row">
          <label for="formAnswers" class="form-label">Accepted answers (comma-separated; multiple words allowed)</label>
          <input type="text" id="formAnswers" class="form-input" placeholder="e.g. Paris, paris" />
        </div>
        <div class="form-row">
          <label for="formExplanation" class="form-label">Explanation (optional)</label>
          <textarea id="formExplanation" class="form-input form-textarea" placeholder="Short explanation shown after answering." rows="2"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" id="deleteSentence" class="btn btn-danger modal-footer-left" hidden>Delete</button>
        <div class="modal-footer-actions">
          <button type="button" id="cancelEdit" class="btn btn-secondary">Cancel</button>
          <button type="button" id="submitSentence" class="btn btn-primary">Save sentence</button>
        </div>
      </div>
    </div>
  </div>

  <div id="playSettingsModal" class="modal-overlay" hidden aria-modal="true" role="dialog" aria-labelledby="playSettingsTitle">
    <div class="modal modal--sm">
      <div class="modal-header">
        <h2 id="playSettingsTitle" class="form-panel-title">Play settings</h2>
        <button type="button" class="modal-close" id="playSettingsClose" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <label class="toggle-switch" aria-label="Highlight keyword">
          <input type="checkbox" id="highlightKeywordPlay" />
          <span class="toggle-slider"></span>
          <span class="toggle-text">Highlight keyword</span>
        </label>
        
        <label class="toggle-switch" aria-label="Show pinyin" style="margin-top: 1rem;">
          <input type="checkbox" id="showPinyinToggle" />
          <span class="toggle-slider"></span>
          <span class="toggle-text">Show pinyin</span>
        </label>
      </div>
    </div>
  </div>

  <div id="newCollectionModal" class="modal-overlay" hidden aria-modal="true" role="dialog" aria-labelledby="newCollectionTitle">
    <div class="modal modal--sm">
      <div class="modal-header">
        <h2 id="newCollectionTitle" class="form-panel-title">New collection</h2>
        <button type="button" class="modal-close" id="newCollectionClose" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <label for="newCollectionName" class="form-label">Collection name</label>
          <input type="text" id="newCollectionName" class="form-input" placeholder="e.g. Chapter 1" />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" id="newCollectionCancel" class="btn btn-secondary">Cancel</button>
        <button type="button" id="newCollectionCreate" class="btn btn-primary">Create</button>
      </div>
    </div>
  </div>
  <script src="app.js"></script>
</body>
</html>
